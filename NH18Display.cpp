/*****************************
Newhaven 1.8 Inch TFT Display Library

author: Ryan Sailor
date: 2/25/2014

An Arduino library for communicating
with a Newhaven Display 1.8 inch TFT
display.

******************************/

#include <Arduino.h>
#include "NH18Display.h"

#define writecolor(c) NH18Display::writeData(c >> 8);NH18Display::writeData(c);


/* FONTS */
uint8_t NH18_FONT_CONSOLAS_12[] PROGMEM = {
	5, // index of first letter
	11, // bytes per letter
	7, // horizontal spacing
	7, // char width
	12, // char height
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x81,0x02,0x04,0x00,0x18,0x30,0x00,0x00,0x00,0x00,0xA1,0x42,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xA1,0x4F,0xC5,0x14,0x7E,0x50,0xA0,0x00,0x00,0x00,0x20,0xE2,0x85,0x06,0x06,0x0A,0x24,0xF0,0x80,0x00,0x00,0x03,0x8D,0x2A,0x9E,0x07,0x1A,0x55,0x38,0x00,0x00,0x00,0x00,0xE2,0x44,0x86,0x15,0x4E,0x8C,0xFC,0x00,0x00,0x00,0x00,0x40,0x81,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x40,0x82,0x04,0x08,0x10,0x20,0x20,0x40,0x40,0x00,0x40,0x40,0x80,0x81,0x02,0x04,0x08,0x20,0x41,0x00,0x00,0x00,0x42,0xA3,0x8F,0x84,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x02,0x1F,0x08,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x60,0xC3,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x60,0x00,0x00,0x00,0x00,0x10,0x40,0x82,0x04,0x08,0x20,0x41,0x00,0x00,0x00,0x00,0xF1,0x34,0x69,0x54,0xB1,0x64,0x78,0x00,0x00,0x00,0x00,0xC2,0x81,0x02,0x04,0x08,0x10,0xF8,0x00,0x00,0x00,0x00,0xE2,0x20,0x40,0x82,0x08,0x20,0xF8,0x00,0x00,0x00,0x01,0xE0,0x20,0x47,0x01,0x02,0x04,0xF0,0x00,0x00,0x00,0x00,0x60,0xC2,0x89,0x22,0x7E,0x08,0x10,0x00,0x00,0x00,0x01,0xF2,0x04,0x0F,0x01,0x02,0x0C,0xF0,0x00,0x00,0x00,0x00,0x61,0x04,0x0F,0x11,0x22,0x44,0x70,0x00,0x00,0x00,0x01,0xF0,0x20,0x81,0x04,0x08,0x30,0x40,0x00,0x00,0x00,0x00,0xE2,0x26,0x47,0x1B,0x22,0x44,0x70,0x00,0x00,0x00,0x00,0xE2,0x24,0x48,0x8F,0x02,0x08,0xE0,0x00,0x00,0x00,0x00,0x00,0x03,0x06,0x00,0x00,0x30,0x60,0x00,0x00,0x00,0x00,0x00,0x03,0x06,0x00,0x00,0x30,0x60,0xC3,0x00,0x00,0x00,0x00,0x21,0x84,0x10,0x10,0x18,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x80,0x3E,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x01,0x01,0x04,0x30,0x80,0x00,0x00,0x00,0x00,0xC0,0x60,0x40,0x8E,0x00,0x30,0x60,0x00,0x00,0x00,0x00,0xF3,0x34,0x33,0x6A,0xD5,0xBD,0x01,0x03,0xC0,0x00,0x00,0x41,0x42,0x85,0x11,0x3E,0x44,0x88,0x00,0x00,0x00,0x01,0xE2,0x24,0x4F,0x11,0x22,0x44,0xF0,0x00,0x00,0x00,0x00,0x71,0x04,0x08,0x10,0x20,0x60,0x78,0x00,0x00,0x00,0x01,0xE2,0x64,0x48,0x91,0x22,0x48,0xE0,0x00,0x00,0x00,0x01,0xE2,0x04,0x0F,0x10,0x20,0x40,0xF0,0x00,0x00,0x00,0x01,0xE2,0x04,0x0F,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0x00,0xF2,0x08,0x13,0xA1,0x42,0x44,0x78,0x00,0x00,0x00,0x01,0x12,0x24,0x4F,0x91,0x22,0x44,0x88,0x00,0x00,0x00,0x01,0xF0,0x81,0x02,0x04,0x08,0x10,0xF8,0x00,0x00,0x00,0x01,0xE0,0x40,0x81,0x02,0x04,0x08,0xE0,0x00,0x00,0x00,0x01,0x12,0x45,0x0C,0x18,0x28,0x48,0x88,0x00,0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0xF0,0x00,0x00,0x00,0x01,0x12,0x26,0xCD,0x95,0x22,0x44,0x8C,0x00,0x00,0x00,0x01,0x93,0x26,0x4A,0x95,0x26,0x4C,0x98,0x00,0x00,0x00,0x01,0xE2,0x68,0x50,0xA1,0x42,0xC8,0xF0,0x00,0x00,0x00,0x01,0xE2,0x24,0x48,0x9E,0x20,0x40,0x80,0x00,0x00,0x00,0x01,0xE2,0x68,0x50,0xA1,0x42,0xC8,0xF0,0x80,0xE0,0x00,0x01,0xE2,0x24,0x48,0x9E,0x26,0x44,0x8C,0x00,0x00,0x00,0x00,0xE2,0x04,0x06,0x02,0x02,0x04,0xF0,0x00,0x00,0x00,0x01,0xF0,0x81,0x02,0x04,0x08,0x10,0x20,0x00,0x00,0x00,0x01,0x12,0x24,0x48,0x91,0x22,0x44,0x70,0x00,0x00,0x00,0x01,0x12,0x24,0x4D,0x0A,0x14,0x28,0x20,0x00,0x00,0x00,0x01,0x12,0x24,0x4A,0x9B,0x36,0x6C,0x88,0x00,0x00,0x00,0x03,0x32,0x43,0x86,0x0C,0x34,0x45,0x8C,0x00,0x00,0x00,0x02,0x0A,0x26,0xC5,0x04,0x08,0x10,0x20,0x00,0x00,0x00,0x01,0xF0,0x40,0x82,0x04,0x10,0x20,0xF8,0x00,0x00,0x00,0x00,0xE1,0x02,0x04,0x08,0x10,0x20,0x40,0x81,0xC0,0x00,0x01,0x01,0x02,0x02,0x04,0x08,0x08,0x10,0x10,0x00,0x00,0x00,0xE0,0x40,0x81,0x02,0x04,0x08,0x10,0x21,0xC0,0x00,0x00,0x41,0x44,0x48,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x80,0x8F,0x22,0x4C,0x78,0x00,0x00,0x00,0x01,0x02,0x07,0x8C,0x91,0x22,0x44,0xF0,0x00,0x00,0x00,0x00,0x00,0x03,0xCC,0x10,0x20,0x60,0x78,0x00,0x00,0x00,0x00,0x10,0x23,0xC8,0x91,0x22,0x4C,0x68,0x00,0x00,0x00,0x00,0x00,0x03,0x88,0x9F,0x20,0x60,0x78,0x00,0x00,0x00,0x00,0x79,0x02,0x1F,0x88,0x10,0x20,0x40,0x00,0x00,0x00,0x00,0x00,0x03,0xE8,0x91,0x3C,0x40,0xF9,0x13,0xC0,0x00,0x01,0x02,0x05,0x8C,0x91,0x22,0x44,0x88,0x00,0x00,0x00,0x30,0x60,0x07,0x02,0x04,0x08,0x10,0xF8,0x00,0x00,0x00,0x30,0x60,0x07,0x81,0x02,0x04,0x08,0x10,0x23,0x80,0x00,0x01,0x02,0x04,0x8A,0x18,0x28,0x48,0x88,0x00,0x00,0x00,0x01,0xC0,0x81,0x02,0x04,0x08,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x07,0xCA,0x95,0x2A,0x54,0xA8,0x00,0x00,0x00,0x00,0x00,0x07,0x8C,0x91,0x22,0x44,0x88,0x00,0x00,0x00,0x00,0x00,0x03,0x88,0x91,0x22,0x44,0x70,0x00,0x00,0x00,0x00,0x00,0x07,0x8C,0x91,0x22,0x44,0xF1,0x02,0x00,0x00,0x00,0x00,0x03,0xC8,0x91,0x22,0x4C,0x68,0x10,0x20,0x00,0x00,0x00,0x05,0xCC,0x90,0x20,0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x03,0x88,0x18,0x0C,0x08,0xE0,0x00,0x00,0x00,0x00,0x81,0x0F,0x84,0x08,0x10,0x20,0x70,0x00,0x00,0x00,0x00,0x00,0x04,0x48,0x91,0x22,0x4C,0x78,0x00,0x00,0x00,0x00,0x00,0x04,0x48,0x91,0x14,0x28,0x20,0x00,0x00,0x00,0x00,0x00,0x04,0x4A,0x95,0x2E,0x6C,0x48,0x00,0x00,0x00,0x00,0x00,0x06,0xC5,0x04,0x14,0x45,0x8C,0x00,0x00,0x00,0x00,0x00,0x04,0x48,0x8A,0x14,0x30,0x20,0x87,0x00,0x00,0x00,0x00,0x07,0xC1,0x04,0x08,0x20,0xF8,0x00,0x00,0x00,0x00,0x30,0x81,0x02,0x18,0x08,0x10,0x20,0x40,0x60,0x10,0x20,0x40,0x81,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00,0x01,0x80,0x81,0x02,0x03,0x08,0x10,0x20,0x43,0x00,0x00,0x00,0x00,0x00,0x00,0x39,0x4E,0x00,0x00,0x00,0x00
};

uint8_t NH18_FONT_CONSOLAS_16[] PROGMEM = {
	5,
    20,
    10,
    10,
    16,
	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x00,0x18,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xD8,0x36,0x0D,0x83,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x22,0x08,0x82,0x23,0xFC,0x22,0x11,0x0F,0xF1,0x10,0x44,0x11,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x20,0x3C,0x16,0x05,0x81,0x40,0x30,0x07,0x01,0x20,0x48,0x16,0x1F,0x01,0x00,0x40,0x00,0x00,0x00,0x01,0x84,0x92,0x25,0x89,0x41,0xA0,0x18,0x05,0x83,0x90,0xA4,0x49,0x31,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0xE0,0x44,0x11,0x04,0x41,0xA0,0x30,0x1E,0x88,0xA2,0x38,0xC6,0x1E,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x0C,0x03,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x10,0x0C,0x02,0x01,0x80,0x40,0x10,0x04,0x01,0x00,0x40,0x18,0x02,0x00,0xC0,0x10,0x00,0x00,0x02,0x00,0x40,0x18,0x02,0x00,0xC0,0x10,0x04,0x01,0x00,0x40,0x10,0x0C,0x02,0x01,0x80,0x40,0x00,0x00,0x00,0x00,0x20,0x49,0x0F,0x80,0x80,0xF8,0x49,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x20,0x08,0x1F,0xC0,0x80,0x20,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x07,0x00,0xC0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x06,0x01,0x00,0x40,0x30,0x08,0x06,0x01,0x00,0x40,0x30,0x08,0x02,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x08,0x84,0x11,0x0C,0x4D,0x16,0x46,0x11,0x04,0x22,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x0A,0x04,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x1F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x11,0x80,0x20,0x08,0x02,0x01,0x00,0x80,0x40,0x20,0x1F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x00,0x80,0x20,0x18,0x3C,0x01,0x80,0x20,0x08,0x04,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x07,0x01,0x40,0xD0,0x24,0x11,0x0C,0x43,0xFC,0x04,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x10,0x04,0x01,0x00,0x7C,0x01,0x80,0x20,0x08,0x04,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x0C,0x02,0x01,0x00,0x5E,0x18,0xC4,0x11,0x04,0x23,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0xC0,0x20,0x18,0x04,0x03,0x00,0x80,0x60,0x10,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x10,0x84,0x21,0x98,0x18,0x09,0x04,0x21,0x08,0x62,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x08,0x84,0x11,0x04,0x63,0x0F,0x40,0x10,0x08,0x06,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x18,0x00,0x00,0x00,0x00,0x18,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x18,0x00,0x00,0x00,0x00,0x1C,0x07,0x00,0xC0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0x60,0x30,0x18,0x03,0x00,0x60,0x0C,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x00,0x01,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x01,0x80,0x30,0x06,0x00,0xC0,0x60,0x30,0x18,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x08,0x01,0x00,0x40,0x10,0x38,0x08,0x02,0x00,0x00,0x30,0x0C,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x31,0x18,0x24,0x09,0x7A,0x92,0xA8,0xAA,0x2A,0x9A,0x9F,0x20,0x0C,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x1C,0x05,0x01,0x40,0x58,0x22,0x08,0x82,0x21,0xFC,0x41,0x10,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x10,0x84,0x21,0x18,0x7C,0x11,0x84,0x21,0x08,0x46,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x0C,0x42,0x01,0x00,0x40,0x10,0x04,0x01,0x80,0x21,0x07,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x10,0x84,0x11,0x04,0x41,0x10,0x44,0x11,0x0C,0x46,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x08,0x02,0x00,0x80,0x3F,0x08,0x02,0x00,0x80,0x20,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0x08,0x02,0x00,0x80,0x20,0x0F,0xC2,0x00,0x80,0x20,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1E,0x0C,0x42,0x01,0x00,0x40,0x11,0xC4,0x11,0x84,0x31,0x07,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x10,0x44,0x11,0x04,0x7F,0x10,0x44,0x11,0x04,0x41,0x10,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x0F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x44,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x42,0x11,0x04,0xC1,0x60,0x70,0x1C,0x05,0x81,0x30,0x44,0x10,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x0F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC1,0xB8,0xEE,0x3B,0xD6,0xD5,0xB5,0x6C,0x9B,0x06,0xC1,0xB0,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x61,0x18,0x45,0x11,0x44,0x49,0x12,0x44,0x51,0x14,0x43,0x10,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x10,0x8C,0x12,0x04,0x81,0x20,0x48,0x12,0x0C,0x42,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7C,0x11,0x84,0x21,0x08,0x46,0x1E,0x04,0x01,0x00,0x40,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x11,0x08,0x22,0x08,0x82,0x20,0x88,0x22,0x08,0x44,0x0E,0x01,0x00,0x48,0x00,0x00,0x00,0x00,0x00,0x7C,0x10,0x84,0x21,0x18,0x78,0x12,0x04,0x41,0x10,0x42,0x10,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x10,0x04,0x01,0x00,0x38,0x03,0x00,0x20,0x08,0x02,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x10,0x44,0x11,0x04,0x41,0x10,0x44,0x11,0x04,0x62,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x41,0x10,0x46,0x30,0x88,0x22,0x0D,0x83,0x40,0x50,0x14,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x81,0x20,0x48,0x12,0x24,0x99,0x25,0x4B,0x52,0x94,0xE3,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC3,0x19,0x83,0x40,0xF0,0x18,0x07,0x03,0x40,0x98,0x63,0x30,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x90,0x42,0x20,0xD8,0x14,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0x00,0x80,0x60,0x10,0x08,0x02,0x01,0x00,0xC0,0x20,0x1F,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x00,0x00,0x00,0x01,0x00,0x20,0x08,0x03,0x00,0x40,0x10,0x06,0x00,0x80,0x30,0x04,0x01,0x00,0x60,0x08,0x00,0x00,0x00,0x00,0xF0,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x00,0x00,0x00,0x00,0x00,0x0C,0x05,0x01,0x20,0x8C,0x21,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0x22,0x00,0x83,0xE1,0x08,0x46,0x0E,0x80,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x40,0x10,0x04,0x01,0x70,0x66,0x10,0x84,0x21,0x08,0x44,0x1E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x20,0x10,0x04,0x01,0x00,0x60,0x07,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x02,0x00,0x80,0x20,0x78,0x22,0x10,0x84,0x21,0x08,0x66,0x0E,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x23,0x10,0x47,0xF1,0x00,0x20,0x07,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x3C,0x10,0x04,0x01,0x01,0xF8,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC,0x42,0x10,0x84,0x21,0xF0,0x40,0x1F,0x84,0x11,0x04,0x00,0x00,0x00,0x01,0x00,0x40,0x10,0x04,0x01,0x70,0x62,0x10,0x84,0x21,0x08,0x42,0x10,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x30,0x00,0x00,0x01,0xC0,0x10,0x04,0x01,0x00,0x40,0x10,0x1F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x0C,0x00,0x00,0x01,0xF0,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x41,0x30,0x00,0x00,0x00,0x01,0x00,0x40,0x10,0x04,0x01,0x18,0x48,0x1C,0x05,0x01,0x20,0x44,0x10,0x80,0x00,0x00,0x00,0x00,0x00,0x01,0xC0,0x10,0x04,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x40,0x10,0x1F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xFC,0x6D,0x12,0x44,0x91,0x24,0x49,0x12,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x70,0x62,0x10,0x84,0x21,0x08,0x42,0x10,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x23,0x10,0x44,0x11,0x04,0x62,0x0F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x78,0x63,0x10,0x44,0x11,0x04,0x42,0x1F,0x04,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x22,0x10,0x84,0x21,0x08,0x66,0x0E,0x80,0x20,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xB8,0x31,0x08,0x42,0x00,0x80,0x20,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xF0,0x40,0x18,0x03,0xC0,0x08,0x02,0x1F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x04,0x01,0x01,0xFC,0x10,0x04,0x01,0x00,0x40,0x18,0x03,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x08,0x42,0x10,0x84,0x21,0x08,0x46,0x0E,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x04,0x63,0x08,0x82,0x20,0x50,0x14,0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x04,0x41,0x12,0x45,0x51,0x54,0x55,0x18,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x8C,0x36,0x07,0x00,0xC0,0x58,0x33,0x18,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x04,0x63,0x08,0x82,0x60,0x50,0x14,0x06,0x01,0x80,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0xF8,0x04,0x02,0x01,0x80,0x40,0x20,0x1F,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x18,0x04,0x01,0x00,0x40,0x10,0x18,0x01,0x00,0x40,0x10,0x04,0x01,0x00,0x60,0x00,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x08,0x02,0x00,0x80,0x20,0x00,0x00,0x00,0x01,0xC0,0x18,0x02,0x00,0x80,0x20,0x08,0x01,0x80,0x80,0x20,0x08,0x02,0x00,0x80,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x38,0x93,0x24,0x70,0x00,0x00,0x00,0x00,0x00,0x00
};

/* Font helpers */

int charBuf[8];



void NH18Display::begin() {
    /* control lines set to output */
    DDRB |= 0x70;
	DDRC |= 0x40;
    
    // data lines set to output
    NH18Display::setWrite();

    // set defaults
    delayMicroseconds(1);
    PORTC |= nhRD; // read clock
    PORTB &= ~nhWR; // write clock
    
    // reset screen
    PORTB &= ~nhRST;
    delay(100);
    PORTB |= nhRST;
    delay(100);
    
    // display off
    NH18Display::writeCommand(0x28);
    
    // exit sleep mode
    NH18Display::writeCommand(0x11);
    delay(100);    
    
    // set voltage controls
    NH18Display::writeCommand(0xC0);
    NH18Display::writeData(0x0A);
    NH18Display::writeData(0x00);
    NH18Display::writeCommand(0xC1);
    NH18Display::writeData(0x02);
    NH18Display::writeCommand(0xC5);
    NH18Display::writeData(0x2F);
    NH18Display::writeData(0x3E);
    NH18Display::writeCommand(0xC7);
    NH18Display::writeData(0x40);
    
    // set column range
    NH18Display::writeCommand(0x2A);
    NH18Display::writeData(0x00); // 0
    NH18Display::writeData(0x00);
    NH18Display::writeData(0x00); // 127
    NH18Display::writeData(0x7F);
    
    // set row range
    NH18Display::writeCommand(0x2B);
    NH18Display::writeData(0x00); // 0
    NH18Display::writeData(0x00);
    NH18Display::writeData(0x00); // 159
    NH18Display::writeData(0x9F);
    
    // framerate control
    NH18Display::writeCommand(0xB1);
    NH18Display::writeData(0x0A); 
    NH18Display::writeData(0x14); // ~79 Hz
    
    // set gamma
    NH18Display::writeCommand(0x26);
    NH18Display::writeData(0x01);
    NH18Display::writeCommand(0xF2);
    NH18Display::writeData(0x02);
    
    // Memory Access Control
    NH18Display::writeCommand(0x36);
    NH18Display::writeData(0xC8);
        
    // Interface Pixel Format
    NH18Display::writeCommand(0x3A);
    NH18Display::writeData(0x55);
    
    // Power On Display
    NH18Display::writeCommand(0x29);
    
}

void NH18Display::beginMemWrite() {
    NH18Display::writeCommand(0x2C);
}

void NH18Display::endMemWrite() {
    NH18Display::writeCommand(0x00);
}

void NH18Display::setMemAccess(uint8_t x0,uint8_t x1,uint8_t y0,uint8_t y1) {
    // set column range
    NH18Display::writeCommand(0x2A);
    NH18Display::writeData(0);
    NH18Display::writeData(x0);
    NH18Display::writeData(0);
    NH18Display::writeData(x1);
    
    // set row range
    NH18Display::writeCommand(0x2B);
    NH18Display::writeData(0);
    NH18Display::writeData(y0);
    NH18Display::writeData(0);
    NH18Display::writeData(y1);
}

void NH18Display::drawPixel(uint8_t x, uint8_t y, uint16_t color) {
	NH18Display::setMemAccess(x,x,y,y);
	NH18Display::beginMemWrite();
    writecolor(color);
	NH18Display::endMemWrite();
}

void NH18Display::drawLine(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, uint16_t color) {
	int dx = abs(x1-x0);
	int dy = abs(y1-y0);
	int sx, sy;
	if (x0 < x1) { sx = 1; } else { sx = -1; }
	if (y0 < y1) { sy = 1; } else { sy = -1; }
	int err = dx - dy;
	int e2 = 0;
	
	while(true) {
		NH18Display::drawPixel(x0,y0,color);
		if(x0 == x1 && y0 == y1) break;
		e2 = 2 * err;
		if (e2 > -dy) {
			err -= dy;
			x0 += sx;
		}
		if (x0 == x1 && y0 == y1) {
			drawPixel(x0,y0,color);
			break;
		}
		if (e2 < dx) {
			err += dx;
			y0 += sy;
		}
	}
}

void NH18Display::drawHLine(uint8_t x, uint8_t y, uint8_t len, uint16_t color) {
	NH18Display::setMemAccess(x,x+len-1,y,y);
	NH18Display::beginMemWrite();
	for(int i = 0; i < len; i++) {
		writecolor(color);
	}
	NH18Display::endMemWrite();
}

void NH18Display::drawVLine(uint8_t x, uint8_t y, uint8_t len, uint16_t color) {
	NH18Display::setMemAccess(x,x,y,y+len-1);
	NH18Display::beginMemWrite();
	for(int i = 0; i < len; i++) {
		writecolor(color);
	}
	NH18Display::endMemWrite();
}

void NH18Display::drawTriangle(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, uint8_t x2, uint8_t y2, uint16_t color) {
	NH18Display::drawLine(x0,y0,x1,y1,color);
	NH18Display::drawLine(x1,y1,x2,y2,color);
	NH18Display::drawLine(x2,y2,x0,y0,color);
}

void NH18Display::drawTriangleSolid(uint8_t x0, uint8_t y0, uint8_t x1, uint8_t y1, uint8_t x2, uint8_t y2, uint16_t color) {

	// Find Top and Bottom Y Coordinate
	int ymin = y0;
	if(y1 < ymin) ymin = y1;
	if(y2 < ymin) ymin = y2;
	
	int ymax = y0;
	if(y1 > ymax) ymax = y1;
	if(y2 > ymax) ymax = y2;
	
	// Find Left and Right X Coordinate
	int xmin = x0;
	if(x1 < xmin) xmin = x1;
	//if(x2 < xmin) xmin = x2;

	int xmax = x0;
	if(x1 > xmax) xmax = x1;
	if(x2 > xmax) xmax = x2;
	
	// Scan Bounding Rectangle
	for(int y = ymin; y < ymax; y++) {
		for(int x = xmin; x < xmax; x++) {
			
			// Half-Space Function
			if( (x0-x1) * (y-y0) - (y0-y1) * (x-x0) <= 0
			&& (x1-x2) * (y-y1) - (y1-y2) * (x-x1) <= 0
			&& (x2-x0) * (y-y2) - (y2-y0) * (x-x2) <= 0) {
				NH18Display::drawPixel(x,y,color);
			}
		}
	}
	
}

void NH18Display::drawRect(uint8_t x,uint8_t y,uint8_t w,uint8_t h,uint16_t color) {
	NH18Display::drawHLine(x,y,w,color);
	NH18Display::drawVLine(x,y,h,color);
	NH18Display::drawVLine(x+w-1,y,h,color);
	NH18Display::drawHLine(x,y+h-1,w,color);
}

void NH18Display::drawRectSolid(uint8_t x,uint8_t y,uint8_t w,uint8_t h,uint16_t color) {
	NH18Display::setMemAccess(x,x+w-1,y,y+h-1);
	int size = w*h;
	NH18Display::beginMemWrite();
	for(int i = 0; i < size; i++) {
		writecolor(color);
	}
	NH18Display::endMemWrite();
}

void NH18Display::drawCircle(uint8_t x, uint8_t y, uint8_t rad, uint16_t color) {
	int x0 = rad;
	int y0 = 0;
	int raderr = 1-x0;
	
	while (x0 >= y) {
		NH18Display::drawPixel(x0 + x, y0 + y, color);
		NH18Display::drawPixel(y0 + x, x0 + y, color);
		NH18Display::drawPixel(-x0 + x, y0 + y, color);
		NH18Display::drawPixel(-y0 + x, x0 + y, color);
		NH18Display::drawPixel(-x0 + x, -y0 + y, color);
		NH18Display::drawPixel(-y0 + x, -x0 + y, color);
		NH18Display::drawPixel(x0 + x, -y0 + y, color);
		NH18Display::drawPixel(y0 + x, -x0 + y, color);
    
		y0++;
		if(raderr<0) {
		    raderr += 2*y0+1;
		} else {
		    x0--;
		    raderr += 2*(y0-x0+1);
		}
    }
}

void NH18Display::drawCircleSolid(uint8_t x, uint8_t y, uint8_t rad, uint16_t color) {
	int x0 = rad;
	int y0 = 0;
	int raderr = 1-x0;
	int prevy = -1;
	
	while (x0 >= y0) {
		if(y0 != prevy) {
			NH18Display::drawHLine(-x0 + x, y0 + y, 2*x0, color);
			NH18Display::drawHLine(-y0 + x, x0 + y, 2*y0, color);
			NH18Display::drawHLine(-x0 + x, -y0 + y, 2*x0, color);
			NH18Display::drawHLine(-y0 + x, -x0 + y, 2*y0, color);
			prevy = y0;
		}
    
		y0++;
		if(raderr<0) {
		    raderr += 2*y0+1;
		} else {
		    x0--;
		    raderr += 2*(y0-x0+1);
		}
    }
}

void NH18Display::drawEllipse(uint8_t x0, uint8_t y0, uint8_t radx, uint8_t rady, uint16_t color) {
	int radx2 = radx * radx;
	int rady2 = rady * rady;
	int frx2 = 4 * radx2, fry2 = 4 * rady2;
	int x, y, sigma;

	for (x = 0, y = rady, sigma = 2*rady2+radx2*(1-2*rady); rady2*x <= radx2*y; x++) {
		NH18Display::drawPixel(x + x0, y + y0, color);
		NH18Display::drawPixel(-x + x0, y + y0, color);
		NH18Display::drawPixel(x + x0, -y + y0, color);
		NH18Display::drawPixel(-x + x0, -y + y0, color);
		if (sigma >= 0) {
		    sigma += frx2 * (1-y);
		    y--;
		}
		sigma += rady2 * ((4*x) + 6);
	}


	for (x = radx, y = 0, sigma = 2*radx2+rady2*(1-2*radx);  radx2*y <= rady2*x; y++) {
		NH18Display::drawPixel(x + x0, y + y0, color);
		NH18Display::drawPixel(-x + x0, y + y0, color);
		NH18Display::drawPixel(x + x0, -y + y0, color);
		NH18Display::drawPixel(-x + x0, -y + y0, color);
		if (sigma >= 0) {
		    sigma += fry2 * (1-x);
		    x--;
		}
		sigma += radx2 * ((4 * y) + 6);
	}
	
}

void NH18Display::drawEllipseSolid(uint8_t x0, uint8_t y0, uint8_t radx, uint8_t rady, uint16_t color) {
	int radx2 = radx * radx;
	int rady2 = rady * rady;
	int frx2 = 4 * radx2, fry2 = 4 * rady2;
	int x, y, sigma;
	  
	for (x = 0, y = rady, sigma = 2*rady2+radx2*(1-2*rady); rady2*x <= radx2*y; x++) {
		NH18Display::drawHLine(-x + x0, y + y0,2*x,  color);
		NH18Display::drawHLine(-x + x0, -y + y0,2*x, color);
		if (sigma >= 0) {
		    sigma += frx2 * (1-y);
		    y--;
		}
		sigma += rady2 * ((4*x) + 6);
	}
	  
	  
	for (x = radx, y = 0, sigma = 2*radx2+rady2*(1-2*radx);  radx2*y <= rady2*x; y++) {
		NH18Display::drawHLine(-x + x0, y + y0,2*x, color);
		NH18Display::drawHLine(-x + x0, -y + y0, 2*x,color);
		if (sigma >= 0) {
		    sigma += fry2 * (1-x);
		    x--;
		}
		sigma += radx2 * ((4 * y) + 6);
	}
}


void NH18Display::extractFont(uint8_t* font, int index) {
	int b = pgm_read_byte_near(font + index);
	for(int i = 0; i < 8; i++) {
		charBuf[i] = b & 0x01;
		b >>= 1;
	}
}

void NH18Display::drawChar(uint8_t x, uint8_t y, uint8_t* font, int charIndex, uint8_t size, uint8_t charWidth, uint8_t charHeight, uint16_t color) {
	
	int wCount = 0;
	int maxY = y + charHeight - 1;
	
	for(int i = charIndex; i < charIndex+size; i++) {
		NH18Display::extractFont(font,i);
		
        for(int j = 7; j >= 0; j--) {
            if(charBuf[j] == 1)
				NH18Display::drawPixel(x,y,color);
            wCount++;
            x++;
            if(wCount == charWidth) {
                y++;
                x -= charWidth;
                wCount = 0;
            }
            if(y > maxY) {
                break;
            }
        }
		
	}
}

void NH18Display::drawText(uint8_t x, uint8_t y, const char* text, int len, uint8_t* fontface, uint16_t color) {
   
    int start = pgm_read_byte_near(fontface + 0);
    int bpl = pgm_read_byte_near(fontface + 1);
    int spacing = pgm_read_byte_near(fontface + 2);
    int cw = pgm_read_byte_near(fontface + 3);
    int ch = pgm_read_byte_near(fontface + 4);
    int charcounter = 0;
    
    for(int i = 0; i<len; i++) {
        if (text[i] == '\n') { // newline
            y += (ch);
            x -= spacing * charcounter;
            charcounter = 0;
        } else if (text[i] == '\0') { // null char
            break;
        } else {
            int tval = (int)text[i]-32;
            int ci = start + tval*bpl;
            NH18Display::drawChar(x,y,fontface,ci,bpl,cw,ch,color);
            x += spacing;
            charcounter++;
        }
    }
}



void NH18Display::fill(uint16_t color) {
	NH18Display::drawRect(0,0,128,160,color);
}

void NH18Display::writeCommand(uint8_t cmd) {
    NH18Display::setCommand();
    NH18Display::setWrite();
    
    PORTF = (PORTF & ~0xF0) + ((cmd << 2) & 0xF0);
    PORTD = (PORTD & ~0x93) + (cmd & 0x83) + ((cmd >> 2) & 0x10);
    
    PORTB &= ~nhWR;
    PORTB |= nhWR;
}

void NH18Display::writeData(uint8_t data) {
    NH18Display::setData();
    NH18Display::setWrite();
    
    PORTF = (PORTF & ~0xF0) + ((data << 2) & 0xF0);
    PORTD = (PORTD & ~0x93) + (data & 0x83) + ((data >> 2) & 0x10);
    
    PORTB &= ~nhWR;
    PORTB |= nhWR;
}


void NH18Display::setCommand() {
    PORTB &= ~nhDC;
}

void NH18Display::setData() {
    PORTB |= nhDC;
}

void NH18Display::setWrite() {    
    DDRF |= 0xF0;
    DDRD |= 0x93;
}

void NH18Display::setRead() {    
    DDRF &= ~0xF0;
    DDRD &= ~0x93;
}